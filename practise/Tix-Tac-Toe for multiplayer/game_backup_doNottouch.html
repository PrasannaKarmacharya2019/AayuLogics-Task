<!DOCTYPE html>
<html>

<head>
  <style>
    .main_container {
      display: flex;
      flex-direction: row;
      /* flex-wrap: wrap; */
      /* overflow: hidden; */
      justify-content: space-between;

    }

    #container {
      display: grid;
      grid-template-columns: 33% 33% 33%;
      background-color: dodgerblue;
      padding: 4px;
      width: 30%;
      justify-content: center;
      align-items: center;
      margin: auto;
    }

    #container div {
      background-color: #f1f1f1;
      border: 1px solid black;
      padding: 10px;
      font-size: 30px;
      text-align: center;
      height: 100px;
      align-content: center;


    }

    #close-modal-btn {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #close-modal-btn:hover {
      background-color: #c0392b;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: background-color 1s ease-out, transform 1s ease-out;
    }

    .start-button {
      padding: 10px 10px;
      /* font-size: 1.5rem; */
      background: #4ecdc4;
      border: none;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .start-button:hover {
      transform: scale(1.05);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.3);
    }

    h1 {
      display: flex;
      justify-content: center;
    }

    body {
      background-color: aliceblue;


    }

    #playerTurn {
      display: flex;
      justify-content: center;
      font-size: larger;
    }

    /* CSS for playerlogin */
    .container {
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      /* width: 100%; */
      max-width: 400px;
    }

    h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
    }

    form {
      display: flex;
      flex-direction: column;
    }

    label {
      margin-bottom: 5px;
      font-weight: 600;
      color: #555;
    }

    input {
      padding: 12px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }

    input:focus {
      outline: none;
      border-color: #007BFF;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
    }

    button {
      padding: 14px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #0056b3;
    }

    .form-footer {
      text-align: center;
      margin-top: 20px;
      font-size: 14px;
    }

    .form-footer a {
      color: #007BFF;
      text-decoration: none;
      margin-left: 5px;
    }

    .form-footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>

  <h1>Welcome to Tic-Tac-Toe Game</h1>
  <p id="playerTurn"> </p>
  <h1 id="victory"> </h1>
  <!-- login form for player1 -->
  <div class="main_container">
    <div id="player1">
      <div id="score1"></div>
      <div class="container">

        <form id="signup-form">
          <label for="username">Username</label>
          <input type="text" id="username1" placeholder="Enter your username" required />

          <label for="password">Password</label>
          <input type="password" id="password1" placeholder="Enter your password" required />

          <button type="submit" id="player" onclick="login1(event)">Log In</button>
        </form>

      </div>
    </div>

    <div id="container">

      <div onclick="myFunction(0)" data-index="0"></div>
      <div onclick="myFunction(1)" data-index="1"></div>
      <div onclick="myFunction(2)" data-index="2"></div>
      <div onclick="myFunction(3)" data-index="3"></div>
      <div onclick="myFunction(4)" data-index="4"></div>
      <div onclick="myFunction(5)" data-index="5"></div>
      <div onclick="myFunction(6)" data-index="6"></div>
      <div onclick="myFunction(7)" data-index="7"></div>
      <div onclick="myFunction(8)" data-index="8"></div>
    </div>



    <!-- player 2 login form -->
    <div id="player2">
      <div id="score2"></div>
      <div class="main_container">
        <div id="player2">
          <div class="container">

            <form id="signup-form">
              <label for="username">Username</label>
              <input type="text" id="username2" placeholder="Enter your username" required />

              <label for="password">Password</label>
              <input type="password" id="password2" placeholder="Enter your password" required />

              <button type="submit" id="submit" onclick="login2(event)">Log In</button>
            </form>

          </div>

        </div>
      </div>

</body>
<script>
  let loggedInUser1 = null;
  let loggedInUser2 = null;
  let scores = JSON.parse(localStorage.getItem('scores')) || {};

  function updateScore(username, isWin) {
    if (!scores[username]) {
      scores[username] = { wins: 0, losses: 0 };
    }
    if (isWin) {
      scores[username].wins = scores[username].wins + 1;
    }
    else {
      scores[username].losses = scores[username].losses + 1;
    }
    localStorage.setItem('scores', JSON.stringify(scores));
  }


  function displayScore(username, divID) {
    const s = scores[username] || { wins: 0, losses: 0 };
    // console.log(document.getElementById(divID).value);
    document.getElementById(divID).innerText = `Wins:${s.wins},  Losses:${s.losses}`;
  }

  function login1(event) {
    event.preventDefault();
    const usernm = document.getElementById("username1").value;
    const pass = document.getElementById("password1").value;
        const users = JSON.parse(localStorage.getItem("users"))||[];
           const user = users.find(u => u.username === usernm && u.password === pass);
       if (user) {
        localStorage.setItem('loggedInUser1', JSON.stringify(user));
        // console.log("loggedInUser1 is",loggedInUser1);
             loggedInUser1 = user.username;
            //  console.log("loggedUser1 is",loggedUser1)
                          displayScore(loggedInUser1, "score1");
      alert('Userleft Login successful!');
    } else {
      alert('Invalid username or password for left user');
    }
  }

  function login2(event) {
    event.preventDefault();
    const usernm = document.getElementById("username2").value;
    const pass = document.getElementById("password2").value;
    const users = JSON.parse(localStorage.getItem("users"))|| [];
    const user = users.find(u => u.username === usernm && u.password === pass);
    console.log("Found user is:", user);
    if (user) {
      localStorage.setItem('loggedInUser2', JSON.stringify(user));
      loggedInUser2 = user.username;
      
      displayScore(loggedInUser2, "score2");
      alert('User right Login successful!');
    }
    else {
      alert('Invalid username or password right');
    }
  }

  let board = ["", "", "", "", "", "", "", "", ""];
  let currentPlayer = "X";
  let gameActive = true;
  const winPattern = [[0, 1, 2], [0, 3, 6], [0, 4, 8], [3, 4, 5], [1, 4, 7], [2, 4, 6], [6, 7, 8], [2, 5, 8]];
  let winner = false;

  document.getElementById("playerTurn").innerText = `Current player turn: ` + currentPlayer;

  function myFunction(index) {
    if (!loggedInUser1 || !loggedInUser2) {
      alert("Please login for both player first!!");
      return;
    }
    if (!gameActive) {
      alert("Game over!");
      console.log("Game Over!!!!!!!!!!!!!!!");
      return;
    }
    board[index] = currentPlayer;
    document.querySelector(`[data-index="${index}"]`).innerText = currentPlayer;
    check(board);
    if (winner) {
      gameActive = false;
      return;
    }

    if (currentPlayer === "X") {
      currentPlayer = "O";
      if (gameActive == true) {
        document.getElementById("playerTurn").innerText = `Current player turn:` + currentPlayer;
      }
    }
    else {
      currentPlayer = "X";
      if (gameActive == true) {
        document.getElementById("playerTurn").innerText = `Current player turn:` + currentPlayer;
      }

    }
    console.log("CurrentPlayer:", currentPlayer);
  }
  function check(board) {

    for (let key of winPattern) {
      let [a, b, c] = key;
      if (board[a] === "O" && board[b] === "O" && board[c] === "O") {
        console.log("Winner is O");
        document.getElementById("victory").innerText = "Winner is O";
        //  open model code function here
        winner = true;
        gameActive = false;
        createAndAppendModal(currentPlayer, winner);
        updateScore(loggedInUser2, true);
        updateScore(loggedInUser1, false);
        displayScore(loggedInUser1, 'score1');
        displayScore(loggedInUser2, 'score2');

        if (winner == true) {
          document.getElementById("playerTurn").innerText = "We have a winner";
        }
        return;

      } else if (board[a] === "X" && board[b] === "X" && board[c] === "X") {
        console.log("Winner is X");
        document.getElementById("victory").innerText = "Winner is X";
        //  open model code function here  

        winner = true;
        gameActive = false;
        createAndAppendModal(currentPlayer, winner);
        updateScore(loggedInUser1, true);
        updateScore(loggedInUser2, false);
        displayScore(loggedInUser1, 'score1');
        displayScore(loggedInUser2, 'score2');
        if (winner == true) {
          document.getElementById("playerTurn").innerText = "We have a winner";
        }
        return;
      } else {
        winner = false;

      }
    }
    if (!board.includes("") && !winner) {
      console.log("This match is a draw!!!");
      document.getElementById("victory").innerText = "It's a draw!";
      gameActive = false;
      winner = false;
      createAndAppendModal(currentPlayer, winner)
      return;
    }

  }
  function createAndAppendModal(player, winner) {
    const modal = document.createElement('div');
    modal.classList.add('modal');
    // modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 1000;';
    const modalContent = document.createElement('div');
    modalContent.classList.add('modal-content');
    modalContent.style.cssText = 'background-color: rgba(65, 198, 143, 0.90); padding: 20px; border-radius: 5px; width:30%; height:30%; position:relative; text-align:center;'

    if (winner == true) {
      modalContent.innerHTML = ` 
  <h2>We have a win</h2>
        <p>The winner is player ${player}</p>
        
          <button id="close-modal-btn">Close &times</button> 
          <p><button onclick="switchto()" class="start-button">Back to Scores</button></p>
    `;
    }
    else if (winner == false) {
      modalContent.innerHTML = `
       <h2>We have a Draw!!</h2>
    
              <button id="close-modal-btn">Close &times</button> 
             <p> <button onclick="switchto()" class="start-button">Back to Scores</button></p>
          `;
      modalContent.style.cssText = 'background-color: rgba(172, 221, 73, 0.9); padding: 20px; border-radius: 5px; width:30%; height:30%; position:relative; text-align:center;'
    }

    modal.appendChild(modalContent);
    document.body.appendChild(modal);
    document.getElementById('close-modal-btn').addEventListener('click', () => {
      document.body.removeChild(modal);
    });
    modal.addEventListener('click', (event) => {
      if (event.target === modal) {
        document.body.removeChild(modal);
      }
    });
  }


  // Switch page function
  function switchto() {
    window.location.href = "score.html";
  }
</script>

</html>